<!DOCTYPE html>
<html lang="en-us">
    <head>
        <style>
            a {
                word-wrap: break-word;
            }
        </style>
    </head>  
    <body>
        <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Apache ShardingSphere 5.1.0 Now Available &middot; ShardingSphere - Blog</title>

		
  		<link rel="stylesheet" href="https://shardingsphere.apache.org/blog/css/style.css">
		<link rel="stylesheet" href="https://shardingsphere.apache.org/blog/css/fonts.css">
		
		<link rel="icon" type="image/png" sizes="32x32" href="https://shardingsphere.apache.org/blog/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="https://shardingsphere.apache.org/blog/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="https://shardingsphere.apache.org/blog/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="ShardingSphere - Blog" />
	</head>

        <div style="position: sticky; position: -webkit-sticky; top: 0px; background-color: rgba(255, 255, 255, 0.888);">		<nav class="nav">
			<div class="nav-container">
				<a href="https://shardingsphere.apache.org/blog/">
					<h1 class="nav-title">ShardingSphere - Blog</h1>
				</a>

				<span style="padding-left: 65px;">
					
					
					<li>
						<a href="https://shardingsphere.apache.org/blog/en/material/">
							<h3>Articles</h3>
						</a>
					</li>
					
					<li>
						<a href="https://shardingsphere.apache.org/blog/en/videos/">
							<h3>Videos</h3>
						</a>
					</li>
					
				</span>

				<span style="position: relative; left: 75px; 
				background: rgba(0, 0, 0, 0.664);
				font-weight: bold;
				padding:0.1rem; 
				padding-left:15px; 
				padding-right:15px; 
				padding-top: 2px; 
				padding-bottom: 5px; 
				border-radius:10px;">
					
				</span>
			</div>
			</div>
		</nav></div>
        

<main>
	<div class="post">
		<h1 class="post-title">Apache ShardingSphere 5.1.0 Now Available</h1>

		<div class="post-info">
        
</div>

		

		<h1 id="apache-shardingsphere-510-now-available">Apache ShardingSphere 5.1.0 Now Available</h1>
<p><img src="https://shardingsphere.apache.org/blog/img/Apache_ShardingSphere_releases_5.1.0.png" alt="1"></p>
<p><a href="https://github.com/apache/shardingsphere">Apache ShardingSphere 5.1.0</a> is officially released and available. The previous 5.0.0 GA version was launched in November last year, and marked ShardingSphere’s evolution from middleware to an ecosystem.</p>
<p>This meant gaining the power to transform any database in a distributed database system, and enhance it with features such as data sharding, distributed transaction, data encryption, SQL audit, database gateway, and more.</p>
<p>For the past three months, the ShardingSphere community received a lot of feedback from developers, partners, and users across different industries. We’d like to extend our gratitude for the feedback they provided, because, without it, this update would not be possible.</p>
<p>Our community author and Apache ShardingSphere PMC, <a href="https://twitter.com/HaoranMeng2">Meng Haoran</a>, shares with you in detail what’s new in Apache ShardingSphere version 5.1.0.</p>
<p>Based on user feedback from the 5.0.0 GA version, we also decided to commit our efforts to improve ShardingSphere’s ecosystem, kernel and feature modules:</p>
<h2 id="kernel">Kernel</h2>
<p>Building a powerful and stable kernel has always been the purpose of ShardingSphere.</p>
<p>In the new version we fix a large number of issues to better support parsing for <a href="https://www.postgresql.org/">PostgreSQL</a> and <a href="https://opengauss.org/en/">openGauss</a> SQL, and now support function parsing and <code>binlog</code> statement parsing.</p>
<p>W also optimized the rewriter engine and improved efficiency for loading massive single tables, to further improve overall kernel performance. Moreover, ShardingSphere now adds the SQL <code>hint</code> function that enables users to use the forced routing function more conveniently.</p>
<h2 id="access-terminal">Access Terminal</h2>
<p>For ShardingSphere-Proxy, we fix the issue of parsing <a href="https://www.mysql.com/">MySQL</a>/PostgreSQL protocol, while we also added <code>SCRAM SHA-256</code>authentication mode to support openGauss and optimize the openGauss batch inserts protocol to improve the data insert performance.</p>
<p>For ShardingSphere-JDBC, we removed check for <code>NULL</code> values in rules, so users can still use JDBC even if there is no value in rules. We also optimized the metadata of the logical database only loading the specified <code>schemaName</code>to accelerate boot-up.</p>
<h2 id="elastic-scale-out">Elastic Scale-Out</h2>
<p>We made many adjustments to elastic scale-out in this version.</p>
<p>First, the original scaling module is moved to the data-pipeline module under the kernel. In the future, this module will provide most data processing capabilities except for data migration.</p>
<p>Second, scaling configuration has been moved from <code>server.yaml</code> to the<code>config-sharding.yaml</code> configuration file. Together with data sharding, elastic scale-out will provide users with better data sharding services.</p>
<h2 id="distsql">DistSQL</h2>
<p>Many practical languages can now be implemented. More tools are provided for users to manage the ShardingSphere distributed database ecosystem.</p>
<p>Some distributed cluster governance capabilities are optimized as well. For example, when users enable/stop instances through <code>instanceId</code> while there is only one secondary database, the users will be informed that they cannot stop the instances — significantly improving user experience.</p>
<h2 id="readwrite-splitting-and-high-availability">Read/Write Splitting and High Availability</h2>
<p>The API of read/write splitting and high availability are both optimized. Read/write splitting now supports both static and dynamic configurations, while the static configuration needs to be used with high availability.</p>
<p>The high availability configuration and algorithm are isolated, making its configuration more unified and concise. Additionally, <code>SpringBoot</code> and <code>Spring Namespace</code>now support the configuration of high availability as well as the implementation of openGauss’ high availability feature.</p>
<h2 id="shadow-database">Shadow Database</h2>
<p>The shadow database feature has been partly optimized. It now supports logic data source transmission, provides checking for data types that are not supported by column matching shadow algorithms, annotates that shadow algorithm is reconstructed as <code>HINT</code> shadow algorithm, removes enable attribute in configuration, and optimizes the determining logic of shadow algorithm, improving performance.</p>
<p>This post only covers a a part of the updates we made to some functions. While developing version 5.1.0, we merged 1000+ PRs from the community. Based on version 5.0.0 GA, version 5.1.0 has been significantly improved in terms of its kernel capabilities, core functions, and performance to deliver a better user experience.</p>
<p>Here are the details of the release of version 5.1.0:</p>
<h2 id="new-features">New Features</h2>
<ol>
<li>
<p>Support SQL <code>hint</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW AUTHORITY RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW TRANSACTION RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>ALTER TRANSACTION RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW SQL_PARSER RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>ALTER SQL_PARSER RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>ALTER DEFAULT SHARDING STRATEGY</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>DROP DEFAULT SHARDING STRATEGY</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>CREATE DEFAULT SINGLE TABLE RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW SINGLE TABLES</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW SINGLE TABLE RULES</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW SHARDING TABLE NODES</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>CREATE/ALTER/DROP SHARDING KEY GENERATOR</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW SHARDING KEY GENERATORS</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>REFRESH TABLE METADATA</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>PARSE SQL</code>, output the abstract syntax tree obtained by parsing SQL</p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW UNUSED SHARDING ALGORITHMS</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW UNUSED SHARDING KEY GENERATORS</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>CREATE/DROP SHARDING SCALING RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>ENABLE/DISABLE SHARDING SCALING RULE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW SHARDING SCALING RULES</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>SHOW INSTANCE MODE</code></p>
</li>
<li>
<p>New DistSQL syntax: <code>COUNT SCHEMA RULES</code></p>
</li>
<li>
<p>Scaling: Add <code>rateLimiter</code> configuration and QPS TPS implementation</p>
</li>
<li>
<p>Scaling: Add <code>DATA_MATCH</code> data consistency check</p>
</li>
<li>
<p>Scaling: Add <code>batchSize</code> configuration to avoid possible OOME</p>
</li>
<li>
<p>Scaling: Add <code>streamChannel</code>configuration and <code>MEMORY</code> implementation</p>
</li>
<li>
<p>Scaling: Support MySQL <code>BINARY</code> data type</p>
</li>
<li>
<p>Scaling: Support MySQL <code>YEAR</code> data type</p>
</li>
<li>
<p>Scaling: Support PostgreSQL <code>BIT</code> data type</p>
</li>
<li>
<p>Scaling: Support PostgreSQL <code>MONEY</code> data type</p>
</li>
<li>
<p>Database discovery adds support for JDBC <code>Spring Boot</code></p>
</li>
<li>
<p>Database discovery adds support for JDBC <code>Spring Namespace</code></p>
</li>
<li>
<p>Database discovery adds support for openGauss</p>
</li>
<li>
<p>Shadow DB adds support for logical data source transfer</p>
</li>
<li>
<p>Add data type validator for column matching shadow algorithm</p>
</li>
<li>
<p>Add support for <code>xa start/end/prepare/commit/recover</code> in encrypt case with only one data source</p>
</li>
</ol>
<h2 id="api-changes">API Changes</h2>
<ol>
<li>
<p>Redesign the database discovery related DistSQL syntax</p>
</li>
<li>
<p>In DistSQL, the keyword <code>GENERATED_KEY</code> is adjusted to <code>KEY_GENERATE_STRATEGY</code></p>
</li>
<li>
<p>Native authority provider is marked as deprecated and will be removed in a future version</p>
</li>
<li>
<p>Scaling: Move scaling configuration from <code>server.yaml</code> to <code>config-sharding.yaml</code></p>
</li>
<li>
<p>Scaling: Rename <code>clusterAutoSwitchAlgorithm</code> SPI to <code>completionDetector</code> and refactor method parameter</p>
</li>
<li>
<p>Scaling: Data consistency check API method rename and return type change</p>
</li>
<li>
<p>Database discovery module API refactoring
Read/write-splitting supports static and dynamic configuration</p>
</li>
<li>
<p>Shadow DB remove the enable configuration</p>
</li>
<li>
<p>Shadow algorithm type modified</p>
</li>
</ol>
<h2 id="enhancements">Enhancements</h2>
<ol>
<li>
<p>Improve load multi single table performance</p>
</li>
<li>
<p>Remove automatically added order by primary key clause</p>
</li>
<li>
<p>Optimize binding table route logic without sharding column in join condition</p>
</li>
<li>
<p>Support update sharding key when the sharding routing result keep the same</p>
</li>
<li>
<p>Optimize rewrite engine performance</p>
</li>
<li>
<p>Support <code>select union/union all</code> statements by federation engine</p>
</li>
<li>
<p>Support insert on duplicate key update sharding column when route context keep same</p>
</li>
<li>
<p>Use union all to merge sql route units for simple select to improve performance</p>
</li>
<li>
<p>Supports autocommit in <code>ShardingSphere-Proxy</code></p>
</li>
<li>
<p>ShardingSphere openGauss Proxy supports <code>SHA-256</code> authentication method</p>
</li>
<li>
<p>Remove property <code>java.net.preferIPv4Stack=true</code> from Proxy startup script</p>
</li>
<li>
<p>Remove the verification of null rules for JDBC</p>
</li>
<li>
<p>Optimize performance of executing openGauss batch bind</p>
</li>
<li>
<p>Disable Netty resource leak detector by default</p>
</li>
<li>
<p>Supports describe prepared statement in PostgreSQL / openGauss Proxy</p>
</li>
<li>
<p>Optimize performance of executing PostgreSQL batched inserts</p>
</li>
<li>
<p>Add <code>instance_id</code> to the result of <code>SHOW INSTANCE LIST</code></p>
</li>
<li>
<p>Support to use <code>instance_id</code> to perform operations when <code>enable/disable</code> a proxy instance</p>
</li>
<li>
<p>Support auto creative algorithm when <code>CREATE SHARING TABLE RULE</code>, reducing the steps of creating rule</p>
</li>
<li>
<p>Support specifying an existing KeyGenerator when <code>CREATE SHARDING TABLE RULE</code></p>
</li>
<li>
<p><code>DROP DATABASE</code> supports <code>IF EXISTS</code> option</p>
</li>
<li>
<p><code>DATANODES</code> in <code>SHARDING TABLE RULE</code> supports enumerated inline expressions</p>
</li>
<li>
<p><code>CREATE/ALTER SHARDING TABLE RULE</code> supports complex sharding algorithm</p>
</li>
<li>
<p><code>SHOW SHARDING TABLE NODES</code> supports non-inline scenarios (range, time, etc.)</p>
</li>
<li>
<p>When there is only one read data source in the read/write-splitting rule, it is not allowed to be disabled</p>
</li>
<li>
<p>Scaling: Add basic support of chunked streaming data consistency check</p>
</li>
<li>
<p>Shadow algorithm decision logic optimization to improve performance</p>
</li>
</ol>
<h2 id="refactoring">Refactoring</h2>
<ol>
<li>
<p>Refactor federation engine scan table logic</p>
</li>
<li>
<p>Avoid duplicated TCL SQL parsing when executing prepared statement in Proxy</p>
</li>
<li>
<p>Scaling: Add pipeline modules to redesign scaling</p>
</li>
<li>
<p>Scaling: Refactor several job configuration structure</p>
</li>
<li>
<p>Scaling: Precalculate tasks splitting and persist in job configuration</p>
</li>
<li>
<p>Scaling: Add basic support of pipeline-core code reuse for encryption job</p>
</li>
<li>
<p>Scaling: Add basic support of scaling job and encryption job combined running</p>
</li>
<li>
<p>Scaling: Add <code>input</code> and <code>output</code> configuration, including <code>workerThread</code> and <code>rateLimiter</code></p>
</li>
<li>
<p>Scaling: Move <code>blockQueueSize</code> into <code>streamChannel</code></p>
</li>
<li>
<p>Scaling: Change <code>jobId</code> type from integer to text</p>
</li>
<li>
<p>Optimize JDBC to load only the specified schema</p>
</li>
<li>
<p>Optimize meta data structure of the registry center</p>
</li>
<li>
<p>Rename Note shadow algorithm to <code>HINT</code> shadow algorithm</p>
</li>
</ol>
<h2 id="bug-fixes">Bug Fixes</h2>
<ol>
<li>
<p>Support parsing function</p>
</li>
<li>
<p>Fix alter table drop constrain</p>
</li>
<li>
<p>Fix optimize table route</p>
</li>
<li>
<p>Support Route resource group</p>
</li>
<li>
<p>Support parsing binlog</p>
</li>
<li>
<p>Support PostgreSQL/openGauss <code>&amp;</code> and <code>|</code> operator</p>
</li>
<li>
<p>Support parsing openGauss insert on duplicate key</p>
</li>
<li>
<p>Support parse postgreSql/openGauss union</p>
</li>
<li>
<p>Support query which table has column contains keyword</p>
</li>
<li>
<p>Fix missing parameter in function</p>
</li>
<li>
<p>Fix sub query table with no alias</p>
</li>
<li>
<p>Fix utc <code>timestamp</code> function</p>
</li>
<li>
<p>Fix <code>alter encrypt</code> column</p>
</li>
<li>
<p>Support alter column with position <code>encrypt</code> column</p>
</li>
<li>
<p>Fix delete with schema for postgresql</p>
</li>
<li>
<p>Fix wrong route result caused by Oracle parser ambiguity</p>
</li>
<li>
<p>Fix projection count error when use sharding and encrypt</p>
</li>
<li>
<p>Fix <code>npe</code> when using shadow and <code>readwrite_splitting</code></p>
</li>
<li>
<p>Fix wrong metadata when actual table is case insensitive</p>
</li>
<li>
<p>Fix encrypt rewrite exception when execute multiple table join query</p>
</li>
<li>
<p>Fix encrypt rewrite wrong result with table level <code>queryWithCipherColumn</code></p>
</li>
<li>
<p>Fix parsing chinese</p>
</li>
<li>
<p>Fix encrypt exists sub query</p>
</li>
<li>
<p>Fix full route caused by the MySQL <code>BINARY</code> keyword in the sharding condition</p>
</li>
<li>
<p>Fix <code>getResultSet</code> method empty result exception when using <code>JDBCMemoryQueryResult</code> processing statement</p>
</li>
<li>
<p>Fix incorrect shard table validation logic when creating store function/procedure</p>
</li>
<li>
<p>Fix null charset exception occurs when connecting Proxy with some PostgreSQL client</p>
</li>
<li>
<p>Fix executing commit in prepared statement cause transaction status incorrect in MySQL Proxy</p>
</li>
<li>
<p>Fix client connected to Proxy may stuck if error occurred in PostgreSQL with non English locale</p>
</li>
<li>
<p>Fix file not found when path of configurations contains blank character</p>
</li>
<li>
<p>Fix transaction status may be incorrect cause by early flush</p>
</li>
<li>
<p>Fix the unsigned datatype problem when query with <code>PrepareStatement</code></p>
</li>
<li>
<p>Fix protocol violation in implementations of prepared statement in MySQL Proxy</p>
</li>
<li>
<p>Fix caching too many connections in openGauss batch bind</p>
</li>
<li>
<p>Fix the problem of missing data in <code>SHOW READWRITE_SPLITTING RULES</code> when <code>db-discovery</code> and <code>readwrite-splitting</code> are used together</p>
</li>
<li>
<p>Fix the problem of missing data in <code>SHOW READWRITE_SPLITTING READ RESOURCES</code> when <code>db-discovery</code> and <code>readwrite-splitting</code> are used together</p>
</li>
<li>
<p>Fix the NPE when the CREATE SHARDING TABLE RULE statement does not specify the sub-database and sub-table strategy</p>
</li>
<li>
<p>Fix <code>NPE</code> when <code>PREVIEW SQL</code> by <code>schema.table</code></p>
</li>
<li>
<p>Fix <code>DISABLE</code> statement could disable readwrite-splitting write data source in some cases</p>
</li>
<li>
<p>Fix <code>DIABLE INSTANCE</code> could disable the current instance in some cases</p>
</li>
<li>
<p>Fix the issue that user may query the unauthorized logic schema when the provider is <code>SCHEMA_PRIVILEGES_PERMITTED</code></p>
</li>
<li>
<p>Fix <code>NPE</code> when authority provider is not configured</p>
</li>
<li>
<p>Scaling: Fix DB connection leak on XA initialization which triggered by data consistency check</p>
</li>
<li>
<p>Scaling: Fix PostgreSQL replication stream exception on multiple data sources</p>
</li>
<li>
<p>Scaling: Fix migrating updated record exception on PostgreSQL incremental phase</p>
</li>
<li>
<p>Scaling: Fix MySQL 5.5 check <code>BINLOG_ROW_IMAGE</code> option failure</p>
</li>
<li>
<p>Scaling: Fix PostgreSQL xml data type consistency check</p>
</li>
<li>
<p>Fix database discovery failed to modify cron configuration</p>
</li>
<li>
<p>Fix single read data source use weight <code>loadbalance</code> algorithm error</p>
</li>
<li>
<p>Fix create redundant data souce without memory mode</p>
</li>
<li>
<p>Fix column value matching shadow algorithm data type conversion exception</p>
</li>
</ol>
<p><img src="https://shardingsphere.apache.org/blog/img/List_of_contributors.png" alt="2"></p>
<h2 id="apache-shardingsphere-open-source-project-links">Apache ShardingSphere Open Source Project Links:</h2>
<p><a href="https://github.com/apache/shardingsphere">ShardingSphere Github</a></p>
<p><a href="https://twitter.com/ShardingSphere">ShardingSphere Twitter</a></p>
<p><a href="https://join.slack.com/t/apacheshardingsphere/shared_invite/zt-sbdde7ie-SjDqo9%7EI4rYcR18bq0SYTg">ShardingSphere Slack Channel</a></p>
<p><a href="https://shardingsphere.apache.org/community/cn/involved/">Contributor Guide</a></p>
<h2 id="author">Author</h2>
<p><strong>Haoran Meng</strong></p>
<p>SphereEx Senior Development Engineer</p>
<p>Apache ShardingSphere PMC</p>
<p>Previously responsible for the database products R&amp;D at JingDong Technology, he is passionate about Open-Source and database ecosystems. Currently, he focuses on the development of the ShardingSphere database ecosystem and open source community building.</p>
<p><img src="https://shardingsphere.apache.org/blog/img/Meng_Haoran_Photo.png" alt="2"></p>


		
	</div>

	<div class="pagination">
		<a href="https://shardingsphere.apache.org/blog/en/material/feb_23_stack_overflow/" class="left arrow">&#8592;</a>
		<a href="https://shardingsphere.apache.org/blog/en/material/jan_28_full_link_online_stress_testing_for_production_database_apache_shardingsphere_shadow_database_feature_upgrade/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			
			Copyright &copy; 2018-2020, <a href="https://shardingsphere.apache.org/blog/">Apache ShardingSphere</a>, ShardingSphere, Apache, the Apache feather logo, and the Apache ShardingSphere project logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.
			</span>
		</footer>

    </body>
</html>
